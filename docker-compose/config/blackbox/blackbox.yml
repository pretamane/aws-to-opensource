# Blackbox Exporter Configuration
# For synthetic monitoring of HTTP endpoints

modules:
  # HTTP probe for public endpoints (no auth required)
  http_2xx:
    prober: http
    timeout: 10s
    http:
      method: GET
      preferred_ip_protocol: ip4
      follow_redirects: true
      fail_if_ssl: false
      fail_if_not_ssl: false

  # HTTP probe for admin endpoints (expecting 401 Unauthorized without auth)
  http_basic_auth_401:
    prober: http
    timeout: 10s
    http:
      method: GET
      preferred_ip_protocol: ip4
      follow_redirects: true
      fail_if_ssl: false
      fail_if_not_ssl: false
      fail_if_body_matches_regexp:
        - '200 OK'
      fail_if_body_not_matches_regexp:
        - '401 Unauthorized'

  # HTTP probe for measuring latency with SSL certificate validation
  http_latency:
    prober: http
    timeout: 15s
    http:
      method: GET
      preferred_ip_protocol: ip4
      follow_redirects: true
      fail_if_ssl: true  # Require valid SSL certificate
      fail_if_not_ssl: true  # Require SSL
      tls_config:
        insecure_skip_verify: false

  # TCP probe for port connectivity
  tcp_connect:
    prober: tcp
    timeout: 5s
    tcp:
      preferred_ip_protocol: ip4

  # ICMP probe (requires root privileges)
  icmp:
    prober: icmp
    timeout: 5s
    icmp:
      preferred_ip_protocol: ip4
